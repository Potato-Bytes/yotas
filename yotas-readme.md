# yotas - トイレマップSNS 要件定義・設計書

## 概要
yotasは、全国のトイレの位置・清潔度・設備情報を共有するトイレマップSNSアプリです。
ユーザーがトイレ情報を投稿・評価し、清潔で使いやすいトイレを見つけやすくすることを目的としています。

## 技術スタック
- **フロントエンド**: React Native
- **バックエンド**: Firebase (Authentication, Firestore, Storage)
- **地図**: Google Maps API
- **広告**: Google AdMob
- **認証**: Google認証 + 独自トイレDB

## 主要機能

### 1. ユーザー管理
- **認証方式**: Google認証（必須）
- **プロフィール情報**:
  - ニックネーム（必須、重複可）
  - 性別（任意：男性/女性/その他/未設定）
  - 一言自己紹介（任意、50文字以内）
  - アバター画像（任意、デフォルトアイコン用意）

### 2. トイレ情報登録
- **登録権限**: 認証済みユーザーのみ
- **基本情報**:
  - 位置情報（緯度・経度、GPS自動取得）
  - 施設名・カテゴリ（駅/公園/コンビニ/商業施設/公共施設/その他）
  - 男女区分（男女別/男女共用/多目的トイレ）
  - アクセス（誰でも利用可/施設利用者のみ/有料）
  - 営業時間（24時間/時間指定/不明）
- **複数トイレ対応**: 1施設内の複数トイレを階層構造で管理
- **重複防止**: 半径10m以内の既存トイレをチェック

### 3. 口コミシステム
- **評価軸（★1-5）**:
  - 総合評価（必須）
  - 掃除状況（任意）
  - 新しさ（任意）
  - 臭い（任意）
  - 利用者マナー（任意）
  - 害虫の有無（任意）
- **設備情報**:
  - 男女別：男性用（小便器数・洋式数）、女性用（和式数・洋式数）
  - 男女共用：和式数・洋式数
  - 付帯設備：多目的トイレ、ベビーシート、温水洗浄便座
- **投稿内容**:
  - テキスト（任意、200文字以内）
  - 写真（任意、最大3枚）

### 4. バッジシステム
- **口コミ投稿バッジ**: 10件/50件/100件/500件
- **トイレ登録バッジ**: 1件/10件/50件
- **役立ち度バッジ**: 「役に立った」10回/50回/100回
- **地域貢献バッジ**: 同一市区町村10件/同一都道府県50件/10都道府県以上

### 5. 通知機能
- **プッシュ通知（個別ON/OFF可能）**:
  - 自分の口コミに「役に立った」がついた時
  - 新しいバッジを獲得した時
  - 登録したトイレに新しい口コミがついた時（デフォルト：オフ）
  - 周辺のトイレ情報（デフォルト：オフ）
- **通知時間帯設定**: 指定時間外は通知しない

### 6. 検索・フィルター機能
- **検索方法**:
  - 現在地周辺（500m/1km/3km/5km）
  - 住所・駅名・施設名検索
  - 地図ドラッグで範囲検索
- **フィルター条件**:
  - 評価（★4以上等）
  - 施設タイプ
  - 設備（多目的/温水洗浄便座/ベビーシート）
  - アクセス（24時間/誰でも利用可）

### 7. 通報・制限システム
- **通報機能**: 口コミ長押しで通報メニュー表示
- **通報理由**: 不適切な内容/スパム/虚偽情報/誹謗中傷/わいせつな内容/その他
- **自動制限（通報されたユーザー）**:
  - 3回：警告レベル
  - 5回：1日1件投稿制限
  - 10回：7日間投稿停止
  - 20回：アカウント停止
- **自動非表示（通報された口コミ）**:
  - 3回通報：一時非表示
  - 5回通報：完全非表示

### 8. マネタイズ
- Google AdMobバナー広告（邪魔にならない程度）
- 配置：地図画面下部、口コミ一覧間、詳細画面下部

## 画面構成

### メイン構造（3タブ）
```
┌─────────────────────────┐
│ 🔍 [検索窓]         ⚙️  │ ← ヘッダー
├─────────────────────────┤
│      Google Maps       │ ← 地図エリア
│                   📍   │ ← 現在地ボタン
├─────────────────────────┤
│   🗺️   │   ➕   │   📋   │ ← タブバー
└─────────────────────────┘
```

### タブ機能
- 🗺️ マップ: 地図とトイレ表示
- ➕ 投稿: トイレ登録・口コミ投稿
- 📋 履歴: 投稿履歴・お気に入り

### 検索フィルター（展開型）
- ハンバーガーアイコンタップで展開
- 距離、評価、設備、種類、時間でフィルター

## データベース構造（Firestore）

### Usersコレクション
```json
{
  "uid": "Google認証UID",
  "nickname": "ユーザー名",
  "gender": "male/female/other/unspecified",
  "bio": "一言自己紹介",
  "avatarUrl": "プロフィール画像URL",
  "createdAt": "作成日時",
  "reportCount": 0,
  "restrictionLevel": 0,
  "restrictionUntil": null,
  "stats": {
    "reviewCount": 0,
    "toiletCount": 0,
    "helpfulCount": 0
  }
}
```

### Toiletsコレクション
```json
{
  "facilityName": "施設名",
  "facilityType": "駅/公園/コンビニ等",
  "location": {
    "lat": 緯度,
    "lng": 経度,
    "address": "住所"
  },
  "details": {
    "floor": "階数",
    "specificLocation": "詳細位置"
  },
  "type": "男女別/男女共用/多目的",
  "access": "誰でも/施設利用者/有料",
  "hours": "24時間/時間指定",
  "equipment": {
    "male": {"urinal": 0, "western": 0},
    "female": {"japanese": 0, "western": 0},
    "unisex": {"japanese": 0, "western": 0},
    "multipurpose": false,
    "babySheet": false,
    "washlet": false
  },
  "createdBy": "作成者UID",
  "createdAt": "作成日時"
}
```

### Reviewsコレクション
```json
{
  "toiletId": "トイレID",
  "userId": "ユーザーID",
  "ratings": {
    "overall": 5,
    "cleanliness": 4,
    "newness": 3,
    "smell": 4,
    "manners": 3,
    "pest": 5
  },
  "comment": "コメント",
  "photos": ["写真URL1", "写真URL2"],
  "helpfulCount": 0,
  "reportCount": 0,
  "isHidden": false,
  "createdAt": "作成日時"
}
```

## 開発優先順位
1. 基本機能（認証、地図表示、トイレ登録）
2. 口コミ機能
3. 検索・フィルター
4. バッジ・通知機能
5. 通報・制限システム
6. 広告実装

## 注意事項
- 個人情報は最小限に抑える
- 位置情報の取得許可は必須
- 不適切コンテンツへの対策を重視
- オフライン時は閲覧のみ可能
- GDPR対応は簡易実装